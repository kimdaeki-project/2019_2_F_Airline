<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.airline.a1.admin.AdminMapper">
  
	<select id="airlineList" resultType="com.airline.a1.admin.AirlineVO">
	select aName from airline order by aName asc
	</select>
	
	<select id="airallList" resultType="com.airline.a1.booking.FlightDataVO">
	select * from flightData 
	order by depPlandTime desc
	</select>
	
	
	<select id="airpartList" parameterType="com.airline.a1.booking.FlightDataVO" resultType="com.airline.a1.booking.FlightDataVO">
	select * from flightData 
	where airlineNm=#{airlineNm}
	order by depPlandTime desc
	</select>
	
	<select id="getBookingInfo" parameterType="com.airline.a1.checkIn.ETicketVO" resultType="com.airline.a1.checkIn.ETicketVO">
		select depPlandTime,arrPlandTime,kind,bookingTicket.bnum,fnum,bookingTicket.bookingNum,flightBNum,name,bookingTicket.id,depAirportNm,vihicleId,arrAirportNm,depPlandTime,arrPlandTime,totalPrice 
		from flightData join bookingTicket 
		on bookingTicket.depFnum = flightData.fnum 
		join bookingPrice 
		on bookingPrice.bnum = bookingTicket.bnum;
	</select>


<!-- 매출관리 -->
	<select id="saleterm" parameterType="com.airline.a1.booking.FlightDataVO" resultType="com.airline.a1.booking.FlightDataVO">
	select Z.aId vihicleId, Z.aName airlineNm, Z.aCode depPlandTime, Y.airlineNm, ifnull(Y.a, 0) arrPlandTime 
	from (select * from airline order by aName asc) Z
	left outer join 
	(select airlineNm, sum(totalAllPrice) a from 
	(select distinct A.bookingNum, ifnull(A.totalAllPrice,0) totalAllPrice, B.resDate, B.depFnum, C.* 
	from bookingPrice A
	left join bookingTicket B
	on A.bnum = B.bnum
	left join flightData C
	on B.depFnum = C.fnum
	where DATE_FORMAT(resDate, '%Y-%m-%d %H:%i') BETWEEN #{depPlandTime} AND #{arrPlandTime}) D
	group by D.airlineNm
	order by airlineNm asc) Y
	on Z.aName = Y.airlineNm
	where Z.aName like concat(#{airlineNm}, '%')
	order by Z.aName asc
	</select>

  
  </mapper>